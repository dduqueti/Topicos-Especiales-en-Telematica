<% publish_to "/rooms/#{@room.id}" do %>

  var elems = $("a.user_<%= @user.id%>").nextAll(), count = elems.length;
  //Hide the user and then remove it form the DOM	
  $("a.user_<%= @user.id%>").each(function(){
	  	$(this).slideUp("fast",function(){
	  		$(this).remove();
	  		//Decrease the number of users in the room
	  		if (count==0) $("#num-users").text($("#liUsers a").size());
	  	});
	});
  
  
<% end %>

<% publish_to "/rooms/#{@room.id}" do %>
	$("#num-users").text($("#liUsers a").size())
<% end %>